# ë°ì´í„°ë¡œ ì‘ì—…í•˜ê¸°

- ë™ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì •ì ì¸ ì›¹ì‚¬ì´íŠ¸ì™€ ì°¨ë³„í™”í•˜ëŠ” ê²ƒì€ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì£¼ê³  ì €ì¥í•˜ëŠ” ë°ì´í„°ë‹¤.
- ë°ì´í„° í¼ì‹œìŠ¤í„´ìŠ¤(persistence) : ì €ì¥ ë° ì§€ì†ì„± ìœ ì§€

# JDBC

- `JdbcTemplate` í´ë˜ìŠ¤ì— ê¸°ë°˜ì„ ë‘ 
- JDBCë¥¼ ì‚¬ìš©í•  ë•Œ ìš”êµ¬ë˜ëŠ” ëª¨ë“  í˜•ì‹ì ì´ê³  ìƒíˆ¬ì ì¸ ì½”ë“œì—†ì´ ê°œë°œìê°€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ SQL ì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.

> ìŠ¤í”„ë§ MVCì—ì„œëŠ” í´ë˜ìŠ¤ì˜ ì—­í• ì„ êµ¬ë¶„í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

- `query()` : ê°ì²´ì˜ List ë°˜í™˜
- `queryForObject()` : í•˜ë‚˜ì˜ ê°ì²´ë§Œ ë°˜í™˜

### ë°ì´í„° ì €ì¥ ë°©ë²•

- `update()` ë©”ì„œë“œ ì‚¬ìš©
- `SimpleJdbcTemplate` ë˜í¼ í´ë˜ìŠ¤ ì‚¬ìš©

### `@SessionAttributes`

```java
@SessionAttributes("order")
```

- ì„¸ì…˜ì—ì„œ ê³„ì† ë³´ì¡´ë˜ë©´ì„œ ë‹¤ìˆ˜ì˜ ìš”ì²­ì— ê±¸ì³ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.
- í•´ë‹¹ ì»¨íŠ¸ë¡¤ëŸ¬ ì•ˆì—ì„œ ë‹¤ë£¨ëŠ” íŠ¹ì • ëª¨ë¸ ê°ì²´ë¥¼ ì„¸ì…˜ì— ë„£ê³  ê³µìœ í•  ë•Œ ì‚¬ìš©

### `@ModelAttribute`

#### ë©”ì„œë“œ ë ˆë²¨

- ì‚¬ìš©ìê°€ ìš”ì²­ì‹œ ì „ë‹¬í•˜ëŠ” ê°’ì„ ì˜¤ë¸Œì íŠ¸ í˜•íƒœë¡œ ë§¤í•‘
- multipart/form-data í˜•íƒœì˜ íŒŒë¼ë¯¸í„° â¡ï¸ ê°ì²´

```java
@PostMapping
public String processDesign(
  @Valid Taco design,
  Errors errors,
  @ModelAttribute Order order) {
    if (errors.hasErrors()) {
      return "design";
    }
  }
```

## SimpleJdbcInsert

- ë°ì´í„°ë¥¼ ë” ì‰½ê²Œ í…Œì´ë¸”ì— ì¶”ê°€í•˜ê¸° ìœ„í•´ JdbcTemplateì„ ë˜í•‘í•œ ê°ì²´

```java
@Repository
public class JdbcTemplateReservationRepository implements ReservationRepository {
    private final JdbcTemplate jdbcTemplate;
    private final SimpleJdbcInsert jdbcInsert;

    public JdbcTemplateReservationRepository(JdbcTemplate jdbcTemplate, DataSource source) {
        this.jdbcTemplate = jdbcTemplate;
        this.jdbcInsert = new SimpleJdbcInsert(source)
                .withTableName("reservation")
                .usingGeneratedKeyColumns("id");
    }

    @Override
    public Reservation save(Reservation reservationRequest) {
        Map<String, Object> params = new HashMap<>();
        params.put("name", reservationRequest.getName());
        params.put("date", reservationRequest.getDate());
        params.put("time_id", reservationRequest.getTimeId());
        Long id = jdbcInsert.executeAndReturnKey(params).longValue();
        return new Reservation(id, reservationRequest);
    }
}
```

- `application.properties` ë˜ëŠ” `application.yml` íŒŒì¼ì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ë¥¼ ì„¤ì •í•˜ê³ , ì´ ì •ë³´ëŠ” ìë™ìœ¼ë¡œ `DataSource`ì— ì£¼ì…

# JPA

- ìŠ¤í”„ë§ ë°ì´í„° JPA : ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ JPA í¼ì‹œìŠ¤í„´ìŠ¤

## JPA ê°œì²´(entity) ì„ ì–¸

- `@Entity` ì• ë…¸í…Œì´ì…˜ ì¶”ê°€
- id ì†ì„±ì— `@Id` ì§€ì • : ë°ì´í„°ë² ì´ìŠ¤ì˜ ê°œì²´ë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤.
- ì¸ì ì—†ëŠ”(noarguments) ìƒì„±ìë¥¼ ê°€ì ¸ì•¼ í•œë‹¤.
  - Lombok
    ```java
    @NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)
    ```
    - AccessLevel.PRIVATE : ì¸ì ì—†ëŠ” ìƒì„±ì privateë¡œ
    - force=true : final ì†ì„± nullë¡œ ì„¤ì •

```java
@NoArgsConstructor(access=AccessLevel.PRIVATE, force=true)
@Entity
public class Ingredient {

  @Id
  private final String id;
  private final String name;
  private final Type type;
}
```

```java
@Data
@Entity
public class Taco {

  @Id
  @GeneratedValue(strategy=GenerationType.AUTO) // ë°ì´í„°ë² ì´ìŠ¤ ìë™ ìƒì„± ID
  private Long id;

  private Date createdAt;

  @NotNull
  @Size(min=5, message="Name must be at least 5 characters long")
  private String name;

  @ManyToMany(targetEntity=Ingredient.class)
  @Size(min=1, message="You must choose at least 1 ingredient")
  private List<Ingredient> ingredients;

  @Prepersist
  void createdAt() {
    this.createdAt = new Date();
  }
}
```

- `@Table(name="")` : ë°ì´í„°ë² ì´ìŠ¤ì˜ íŠ¹ì • í…Œì´ë¸”ì— ì €ì¥ë˜ì–´ì•¼ í•œë‹¤

  ```java
  @Data
  @Entity
  @Table(name="Taco_Order")
  public class Order implements Serializable {

  }
  ```

## JPA ë¦¬í¼ì§€í„°ë¦¬ ì„ ì–¸

- `CrudRepository` í™•ì¥ ê°€ëŠ¥
  - CRUD ì—°ì‚°ì„ ìœ„í•œ ë©”ì„œë“œê°€ ì„ ì–¸ë˜ì–´ ìˆë‹¤.

```java
public interface TacoRepository extends CrudRepository<Taco, Long> {

}
```

- JPAê°€ ê° ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•´ ì¤€ë‹¤.

## JPA ë¦¬í¼ì§€í„°ë¦¬ ì»¤ìŠ¤í„°ë§ˆì´ì§•

```java
// ğŸ“ OrderRepository
List<Order> findByDeliveryZip(String deliveryZip);
```

- êµ¬í˜„ì²´ ìƒì„± ì‹œ, ìŠ¤í”„ë§ ë°ì´í„°ëŠ” í•´ë‹¹ ë¦¬í¼ì§€í„°ë¦¬ ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ ë©”ì„œë“œë¥¼ ì°¾ì•„ ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„
- ì €ì¥ë˜ëŠ” ê°ì²´ì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë©”ì„œë“œì˜ ìš©ë„ê°€ ë¬´ì—‡ì¸ì§€ íŒŒì•…í•œë‹¤.

### ë¦¬í¼ì§€í† ë¦¬ ë©”ì„œë“œ ì´ë¦„

- ë™ì‚¬, ìƒëµ ê°€ëŠ¥í•œ ì²˜ë¦¬ ëŒ€ìƒ, By ë‹¨ì–´, ì„œìˆ ì–´

```
findByDeliveryZip()
----  -----------
ë™ì‚¬    ì„œìˆ ì–´

â¡ï¸ Order ë¦¬í¼ì§€í† ë¦¬ì´ë¯€ë¡œ ì²˜ë¦¬ ëŒ€ìƒì€ ë¬µì‹œì ìœ¼ë¡œ Order
```

```
readOrdersByDeliveryZipAndPlacedAtBetween()
----      -------------   ---------------

- read : ì½ìŒ(get, find)
- by : ì¼ì¹˜ ì—¬ë¶€ í™•ì¸ì— ì‚¬ìš©ë  ì†ì„±ì˜ ì‹œì‘
- deliveryZip : .deliveryZip ë˜ëŠ” .delivery.zip ì†ì„± ê°’ì˜ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
- placedAt : .placedAt ë˜ëŠ” .placed.at ì†ì„± ê°’ì˜ ì¼ì¹˜ ì—¬ë¶€ í™•ì¸
- between : ì§€ì •ëœ ê°’ì˜ ë²”ìœ„ì— í•´ë‹¹ ê°’ì´ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤
```

- ë³µì¡í•œ ì¿¼ë¦¬ : ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê²ƒì„ ì§€ì •í•œ í›„ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ ìˆ˜í–‰ë˜ëŠ” ì¿¼ë¦¬ì— `@Query` ì• ë…¸í…Œì´ì…˜ ì§€ì •

```java
@Query("Order o where o.deliveryCity='seattle'")
List<Order> readOrdersDeliveredInSeattle();
```
